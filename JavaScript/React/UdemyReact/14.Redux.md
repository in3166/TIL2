# Redux
- Third Party Library
- A **state management system**  for **cross-componenet or app-wide state**
- 변경되는 데이터/state를 관리하고 애플리케이션에 영향을 주는 것까지 관리 (화면에 표시하는 내용까지)

### State의 종류
- **Local state**
  - 데이터가 변경되면 UI에 영향을 주는 State
  - Single Componenet에 속해 있다.
  - `useState()`나 `useReducer()`와 함께 컴포넌트 내부에서 관리되어야만 한다.
  - ex. input - 키입력을 받아 state에 저장, toggle ...

- **Cross-Component State**
  - 여러 개의 컴포넌트에 영향을 끼치는 State
  - E.g. open/closed state of a modal overlay
  - `prop chains`나 `prop drilling`을 사용하여 멀티 컴포넌트에 걸쳐 데이터를 전달하고 혹은 함수를 전달하여 각기 다른 컴포넌트를 함께 작동시키고 state를 함께 관리

- **App-Wide State**
  - 전체 애플리케이션(most/all components)에 영향을 미치는 State 
  - E.g. user authentication status - 로그인 시 내비게이션 변경
  - Requires "prop chains" / "prop drilling"
<br>

- `Redux`는 `Context` 처럼 'Cross Component'나 'Application-wide'에서 `state` 관리를 쉽게 해준다.
  - `prop chains`이나 `prop drilling`을 피하고 중앙에 두고 사용 가능하다.

<br><br>

# Redux VS React Context
- React Context의 단점
  - `Complex Setup / Management`
    - 설정하기 복잡하고 관리하는 것조차도 복잡해질 수 있다.
    - 특히 큰 규모의 애플리케이션을 만들 때 문제가 될 수 있다.
    - 아래의 예제를 하나의 컨텐스트로 통합하면 코드가 너무 복잡해진다.
    ```js
    return (
      <AuthContextProvider>
        <Auth2ContextProvider>
          <Auth3ContextProvider>
            ...
          <Auth3ContextProvider>
        <Auth2ContextProvider>
      </AuthContextProvider>
    )
    ```

  - `Performance`
    - 현재 컨텍스트는 `low-frequency` 업데이트에 좋은 성능을 가진다. (theme, authentication ...)
    - 반대로 `high-frequency` 업데이트에는 성능이 나쁘다. (data 변경이 잦은 경우)

<br><br>

# Redux 작동 방식
- 애플리케이션에 **하나의 중앙 데이터(state) 저장소**를 갖는다. (`Central Data(State) Store`)

- 이 스토어의 데이터를 컴포넌트 내부에서 사용할 수 있다.

  - 일부 데이터가 변경되거나 인증 상태 등이 변경될 경우 컴폰넌트에서 그에 반응하고 UI를 업데이트할 수 있다.
  ```
  [Central Data Store]  ===== (Subscription) =====> [Component]  / 컴포넌트가 중앙 스토어 구독을 설정 (데이터 변경 시 알림)
  ```

<img src="1" width="60%" />

- 저장소에 저장된 데이터를 변경하는 법
  - **컴포넌트는 절대로 저장소의 데이터를 직접 조작하지 않는다.**
  
  - 대신 `Reducer` 함수를 사용한다. (React Hook과 다름)
  
    - `Reducer`는 저장소의 데이터를 변조(mutatate, change)한다.
    - 데이터를 입력하면 데이터를 변환하여 새로운 결과물을 출력한다. (reduce data) ex. 숫자 리스트를 하나의 숫자 합으로 축소.
    - `순수 함수(Pure Function)`여야 하기 때문에 동일한 입력값은 동일한 출력값을 생성해야하며 이 출력값은 항상 새로운 state의 객체이다.
    - 또한, Side-Effect이 없어야 하기 때문에 절대 HTTP 요청이나 로컬 스토리지를 사용하면 안된다.
    - 단순히 `Reducer`는 `Redux`에서 제공한 입력을 수행하는 함수여야 한다.

  - 컴포넌트와 `Reducer` 함수 연결 (`Action`)
  
    - 궁극적으로 컴포넌트가 데이터 변경을 실행해야 하는데 여기서 `Action`을 사용한다.
    - 컴포넌트는 `Action`을 `dispatch`한다. (trigger centain actions)
    - `Action`은 자바스크립트 객체인데 `Reducer`가 수행해야 할 작업의 종류를 설명한다.
    
      - `Redux`는 이 `Action`을 `Reducer` 함수에게 전달(forward)한다.
      - `Reducer`는 작업을 수행하고 새로운 State를 반환하고 중앙 데이터 저장소의 기존 State를 대체한다.
      - 데이터 저장소의 상태가 업데이트 되면 구독중인 컴포넌트는 알림을 받아 UI를 업데이트한다.

<br><br>

# Redux 만 사용해보기
- `npm install redux`
```js
const redux = require("redux");

const counterReducer = (state = { counter: 0 }, action) => {
  if (action.type === "increment") {
    return {
      counter: state.counter + 1,
    };
  }

  return state;
};

// store는 어떤 Reudcer가 스토어를 변경하는지 확인해야 하므로 인자로 전달
const store = redux.createStore(counterReducer); 

const counterSubscriber = () => {
  const latestState = store.getState();
  console.log(latestState);
};

// state가 변경될 때마다 위의 함수를 실행할 수 있도록 Redux가 인식할 수 있게 해야한다.
store.subscribe(counterSubscriber);

// dispatch: action을 전달 ,  action:은 식별자 역할
store.dispatch({ type: "increment" });
```
<br><br>

# React와 함께 사용하기
- `react-redux` 라이브러리 설치
  - React App을 Redux Store, Reducer 등에 연결을 간편하게 해준다. 
  - (Redux는 JavasScript를 위한 패키지이기 때문에 React를 위한 추가 패키지 설치)

- '/src/store' 폴더 생성 후 `index.js` 생성
```js
import {createStore} from 'redux';

const counterReducer = (state = {counter: 0}, action) => {
    if(action.type === 'increment'){
        return {
            counter:state.counter + 1
        }
    }
    // ...
    return state;
}

const store = createStore(counterReducer);

export default store;
```

- `redux store`을 React App에 제공하기
```js
// ./index.js
// Provider 컴포넌트를 사용해 store을 사용할 컴포넌트를 감싸준다.
// 최상위 컴포넌트에서만 해야하는 것은 아니지만 감싼 컴포넌트의 하위 컴포넌트들만 store을 활용할 수 있다.
import { Provider } from "react-redux";

import store from "./store";

ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById("root")
);
```



 
<br><br><br>
<출처>
- Udemy: React 완벽 가이드
