# 위크맵과 위크셋
- 가비지 컬렉션 
  - JS 엔진은 도달 가능한 값을 메모리에 유지한다. 
  
  - 자료구조를 구성하는 요소도 자신이 속한 자료구조가 남아있는 동안 메모리에 유지
    - 객체의 프로퍼티나 배열의 요소, 맵이나 셋의 요소 등
    - 배열에 객체를 추가하고 배열에 객체가 남아있는 한 이 객체도 계속 남아있게 된다. (맵에서 객체를 키로 사용한 경우도 마찬가지)

# 위크맵
- 위크맵(WeakMap)은 위크맵을 사용하면 키로 쓰인 객체가 가비지 컬렉션의 대상이 됩니다.
- 위크맵의 키는 반드시 객체여야 한다. (원시값 불가)
```JS
let weakMap = new WeakMap();

let obj = {};

weakMap.set(obj, "ok"); //정상적으로 동작합니다(객체 키).

// 문자열("test")은 키로 사용할 수 없습니다.
weakMap.set("test", "Whoops"); // Error: Invalid value used as weak map key
```

- 위크맵의 키로 사용된 객체를 참조하는 것이 없다면 해당 객체는 메모리와 위크맵에서 자동 삭제
```js
let john = { name: "John" };

let weakMap = new WeakMap();
weakMap.set(john, "...");

john = null; // 참조를 덮어씀
// john을 나타내는 객체는 이제 메모리에서 지워집니다!
```

- 위크맵은 반복 작업과 keys(), values(), entries() 메서드를 지원하지 않는다. (가비지 컬렉션의 동작 방식 때문)
  - *`가비지 컬렉션이 일어나는 시점은 자바스크립트 엔진이 결정합니다. 객체는 모든 참조를 잃었을 때, 그 즉시 메모리에서 삭제될 수도 있고, 다른 삭제 작업이 있을 때까지 대기하다가 함께 삭제될 수도 있습니다. 현재 위크맵에 요소가 몇 개 있는지 정확히 파악하는 것 자체가 불가능한 것이죠. 가비지 컬렉터가 한 번에 메모리를 청소할 수도 있고, 부분 부분 메모리를 청소할 수도 있으므로 위크맵의 요소(키/값) 전체를 대상으로 무언가를 하는 메서드는 동작 자체가 불가능합니다.`*
  
- 지원하는 메서드
  - `weakMap.get(key)`
  - `weakMap.set(key, value)`
  - `weakMap.delete(key)`
  - `weakMap.has(key)`

<br>

## 유스 케이스: 추가 데이터
- `위크맵`은 부차적 데이터 저장할 곳이 필요할 때 유용
- 서드파티 라이브러리같이 외부 코드에 속한 객체를 가지고 작업을 할 때, 이 객체에 데이터를 추가하면 이 데이터는 객체가 살아있는 동안에만 유효하다.
- 이럴 때 `위크맵`에 원하는 데이터를 저장하고, 키를 객체처럼 사용하면 된다.
- 객체가 가비지 컬렉션의 대상이 되면 데이터도 함께 자동으로 사라진다.
```js
weakMap.set(john, "비밀문서");
// john이 사망하면, 비밀문서는 자동으로 파기됩니다.
```



<br><br><br>
<출처>
- https://ko.javascript.info/weakmap-weakset
